# Bitbank - Relay (bb_relay)

(c) 2021 Bernd Fix <brf@hoi-polloi.org>   >Y<

bb_relay is free software: you can redistribute it and/or modify it
under the terms of the GNU Affero General Public License as published
by the Free Software Foundation, either version 3 of the License,
or (at your option) any later version.

bb_relay is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

SPDX-License-Identifier: AGPL3.0-or-later

# Configuration

Change into the `configurator/` folder. The configuration program will use
a template comnfiguration `config-template.json` and will store the result in a
file named `config.json` for productive use.

## Semi-automatic configuration

This assumes that you are going to setup a new multi-coin HD wallet / Trezor
device. This is the standard procedure for most setups.

### Generate new HD wallet data

As a security measure it is recommended to run this step on an air-gapped
computer or at least in a safe environment (e.g. in a secure system like
[Tails](https://tails.boum.org)). Just copy the `configurator` executable
and the `config-template.json` file to the system; the configurator program
will use the `config-template.json` file and generates a new `config.json`
file you need to deploy later on. Run the configurator:

```bash
./configurator | tee config.log
```

First you will be asked for a passphrase; make sure you use a long and safe
input. Do not reuse existing passphrases, but create a new one especially
for this purpose.

The program will output information to the console; the above command captures
the output to a file `config.log` that can be printed for safe-keeping. Anyone
with access to this information will be able to make transactions! Make sure
you delete the file after printing.

### Initialize HD wallet / Trezor device

Part of the printed information (`config.log`) are the 24 seed words used to
setup a HD wallet or Trezor device.

After setting up the wallet you should check the addresses listed in
`config.log` for all cryptocurrencies to match the addresses generated by the
wallet. Please check at lease two addresses per coin to make sure the setup
worked correctly.

## Manual configuration

If you have an existing HD wallet / Trezor device you want to use without a
full reset with new keys, you can manually setup the `config.json` file - but
it is a time-consuming task.

Copy the `config-template.json` to a new `config.json` and open the new file
in an editor. You need to fill in data for the `pk` and `addr` fields in all
entries in the `coins` section:

```json
"coins": [
    {
        "symb": "btc",
        "path": "m/49'/0'/0'",
        "mode": "P2SH",
        "pk": "",
        "addr": ""
    },

```

Use the wallet UI to extract the `xpub` key for an account and insert the
result in the `pk` field. Also put the first address of an account into
the `addr` field.

### Using a Trezor device

You can use the `trezorctl` utility to generate the required information
from an initialized Trezor device.

**Example**: Generate the info for Bitcoin (`btc`) by running the
following commands:

```bash
trezorctl get-public-node -t p2shsegwit -n "m/49'/0'/0'"
```

The value for `pk` is returned in the line starting with "xpub:"

```bash
trezorctl get-address -t p2shsegwit -n "m/49'/0'/0'/0/0"
```

The command prints the value for `addr`.
